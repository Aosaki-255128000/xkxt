### JWT使用笔记

## **1. 什么是 JWT？**

JWT（JSON Web Token）是一种 **安全传输身份信息的令牌**，用于用户登录后，服务器返回给前端，前端每次请求都带上这个 token，后端用它来验证用户身份。

------

## **2. JWT 在项目中的作用**

- **用来标记已登录用户**，前端拿到 JWT 后存储起来（`localStorage`）。
- **后续请求都带上 JWT**，后端通过 JWT 验证身份，无需重复登录。

------

## **3. 后端如何生成 JWT？**

### **✅ 生成 JWT**

在 **`JWTUtils.java`** 中创建 `generateToken()` 方法：

```java
public static String generateToken(Map<String, Object> map) {
    Calendar instance = Calendar.getInstance();
    instance.add(Calendar.DATE, 7); // 7天后过期

    JWTCreator.Builder builder = JWT.create();
    map.forEach(builder::withClaim);

    return builder.withExpiresAt(instance.getTime()) // 设置过期时间
                  .sign(Algorithm.HMAC256("XIAOSHUANG")); // 签名
}
```

**说明：**

- 令牌里存放用户信息（如 `id`、`username`）。
- 设置了 **7天有效期**。
- **"XIAOSHUANG"** 是签名密钥，必须保密。

------

## **4. 后端如何返回 JWT？**

### **✅ 登录成功后生成 JWT 并返回**

在 `AdminController.java`：

```java
@PostMapping("/login")
public Result login(@RequestBody Admin admin) {
    Admin dbAdmin = adminService.login(admin);
    
    if (dbAdmin != null && dbAdmin.getPassword().equals(admin.getPassword())) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("id", dbAdmin.getId());
        claims.put("username", dbAdmin.getUsername());
        claims.put("role", "admin");

        String token = JWTUtils.generateToken(claims);

        return Result.success().message("登录成功").data("token", token);
    }

    return Result.error().message("用户名或密码错误");
}
```

**说明：**

- 登录成功后，创建一个 **包含用户信息的 JWT**。
- 把 JWT **返回给前端**。

------

## **5. 前端如何存储和使用 JWT？**

### **✅ 登录成功后存储 JWT**

```java
const response = await this.$axios.post('/admin/login', this.ruleForm);

if (response.data.code === 200) {
    const token = response.data.data.token;
    localStorage.setItem('token', token);  // 存储 JWT
    console.log("Received JWT:", token);  // 打印 JWT
    await this.$router.push('/manage');
}
```

**说明：**

- **`localStorage.setItem('token', token);`** 把 JWT 存储到本地。

------

## **6. 后端如何验证 JWT？**

### **✅ 解析和验证 JWT**

在 **`JWTUtils.java`**：

```java
public static DecodedJWT verifyToken(String token) {
    return JWT.require(Algorithm.HMAC256("XIAOSHUANG")).build().verify(token);
}
```

**说明：**

- 解析 JWT，检查 **是否过期、签名是否正确**。

------

## **7. 怎么查看 JWT 里的数据？**

### **✅ 方式 1：后端打印**

在 `AdminController.java`：

```java
System.out.println("Generated JWT: " + token);
```

### **✅ 方式 2：前端打印**

```java
console.log("Received JWT:", token);
```

### **✅ 方式 3：在线解码**

- 复制 JWT 到 [jwt.io](https://jwt.io/)，可以看到用户 `id`、`username` 等信息。

------

## **8. 目前 JWT 还缺少什么？**

✅ **需要前端请求时自动带上 JWT**（后续可以加）。
✅ **需要后端拦截器解析 JWT**（等学到拦截器再做）。

------

## **9. 总结**

**登录时：**

1. **后端生成 JWT**，把 `id`、`username` 等信息存进去，返回给前端。
2. **前端拿到 JWT**，存到 `localStorage` 里。
3. **后续请求带上 JWT**，后端用 `verifyToken()` 解析，确定身份。